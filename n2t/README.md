[Back](../README.md)

# N2T CLI

As discussed in the main [README](../README.md#n2t-command-line-utility) file, this CLI is designed to be a single program that can do all of the following actions:

- Take one or more `.jack` files and compile them into Jack VM language generating a single `.vm` file per `.jack` file
- Take one or more `.vm` files representing Jack VM language, and generate a single `.asm` Hack assembly file as output.
- Take one or more `.asm` Hack assembly files, and generate a single `.hack` file containing 16 bit binary hack instructions.

## Design

I modeled this tool after the code I had already written for my project [ts-monkey](https://github.com/pwbrown/ts-monkey) which was a TypeScript implementation of the Monkey Language Interpreter from the book [Writing an Interpreter in Go](https://interpreterbook.com/) which I consider to my go to first project whenever I want to test out a new language I'm learning. This interpreter using a more traditional lexical analysis approach and a recursive decent parser that generates an abstract syntax tree that is designed to be evaluating an in REPL (read, evaluate, print, loop) style of program. Most of the code written for ts-monkey did not apply to this project, but the core functionality of the lexer was especially helpful.

Based off the core lexer from `ts-monkey` I also added line and column tracking which make it much easier to debug parsing errors and to annotate code that is generated by the compiler and translator. I also included newline characters and comments as token types since the vm code and hack assembly code are line-delimited language formats. The comment tokens are largely unused, but I left them in anyways.

Additionally I included a `BaseParser` that includes all the boilerplate of accepting a Lexer as input, iterating through tokens, and providing helper functions to analyse current and peek token types. Each primary component of the CLI (compiler, translator, assembler) contain their own unique parsers that extend this BaseParser in order to produce the appropriate output.

## Setup

1. Install [nvm - Node Version Manager](https://github.com/nvm-sh/nvm?tab=readme-ov-file#installing-and-updating)
2. Move to n2t directory: `cd n2t`
3. Install NodeJS: `nvm install`
4. Install build dependencies: `npm install`
5. Build and Link the n2t CLI: `npm link n2t`
6. (If source code changes are made) Rebuild and Link the CLI: `npm unlink n2t && npm link n2t`

## Usage

### Compile Jack Code (.jack) to Jack VM Code (.vm)

_**Compile a single Jack file into VM code**_
```sh
n2t compile ./MyCode.jack
# generates ./MyCode.vm
```

_**Recursively compile all Jack files in a directory into VM code**_
```sh
# ./MyCode is a directory (possibly nested) containing .jack files
n2t compile ./MyCode
# generates ./MyCode/**/*.vm
```

_**Additional Options**_
```sh
# Also generates XML files for the tokenizer and parse tree
n2t compile ./MyCode.jack --xml

# Adds line and column annotates to the xml output
n2t compile ./MyCode.jack --xml --source-map

# Annotates the .vm code with helpful debugging comments
n2t compile ./MyCode.jack --annotate
```

### Translate Jack VM Code (.vm) to Hack Assembly (.asm)

_**Assemble a single .vm file into a .asm file**_
```sh
n2t translate ./MyCode.vm
# generates ./MyCode.asm
```

_**Recursively assemble all .vm files within a directory into a SINGLE .asm file (action is derived from the file extension)**_
```sh
# ./my-directory is a directory (possibly nested) containing .vm files
npm translate ./my-directory
# generates a single ./my-directory/my-directory.asm
```

_**Additional Options**_
```sh
# Annotates the .asm code with helpful debugging comments
n2t translate ./MyCode.vm --annotate
```

### Assemble Hack Assembly (.asm) into Hack Binary (.hack)

_**Assemble a single .asm file into a .hack file**_
```sh
n2t assemble ./MyCode.asm
# generates ./MyCode.hack
```

_**Recursively assemble all .asm files within a directory into .hack files**_
```sh
# ./my-directory is a directory (possibly nested) containing .asm files
n2t assemble ./my-directory
# generates ./my-directory/**/*.hack
```

## Inferred Actions

The `n2t` command can be called directly with a file or directory reference without the need for specifying an action. When an action keyword (`compile`, `translate`, `assemble`) is not provided, the action will be inferred using the file extension based on the following priority:

1. `.jack`: Compile
2. `.vm`: Translate
3. `.asm`: Assemble

The reasoning behind this inferred action behavior is to facilitate project submission. In the Nand2Tetris course, the compiler, translator, and assemble are built as 3 distinct projects and so each program did not require specifying an action. I decided to combine all 3 actions into a single tool to allow for sharing code.

### Examples

- If the directory `./MyDir` ONLY contains `.asm` files, then calling `n2t ./MyDir` will behave the same as `n2t assemble ./MyDir`
- If the directory `./MyDir` contains both `.vm` and `asm` files, then calling `n2t ./MyDir` will behave the same as `n2t translate ./MyDir`
- If the directory `./MyDir` contains at least one `.jack` file, then calling `n2t ./MyDir` will behave the same as `n2t compile ./MyDir`